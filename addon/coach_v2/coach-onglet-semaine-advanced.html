<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coach ‚Äî Semaine (Hebdo + Agenda + Plan)</title>
  <style>
    :root{
      --bg:#0f1115; --card:#141822; --ink:#e8ecf3; --muted:#9fb0c3; --chip:#1b2330; --border:#273042;
      --green:#5ee1a8; --blue:#74b3ff; --red:#ff7a7a; --amber:#ffcf66; --gray:#96a2b5; --purple:#b08cff;
    }
    body{background:var(--bg); color:var(--ink); font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    #page{max-width:1200px; margin:24px auto; padding:16px}
    .row{display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:14px;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px}
    h1{font-size:20px; margin:0 0 14px}
    h2{font-size:16px; margin:0 0 10px}
    .muted{color:var(--muted); font-size:12px}

    table{width:100%; border-collapse:collapse; font-size:14px}
    th,td{border-bottom:1px dashed var(--border); padding:8px 6px; text-align:left}
    thead th{font-weight:600; color:var(--muted)}
    tr.active{background:rgba(116,179,255,.08)}

    /* Agenda mini-cal */
    .agenda{display:grid; grid-template-columns:repeat(7,1fr); gap:8px}
    .dayDot{display:flex; flex-direction:column; align-items:center; gap:6px; padding:8px; border:1px solid var(--border); border-radius:12px; background:#121725}
    .dLabel{font-size:12px; color:var(--muted)}
    .dot{width:18px; height:18px; border-radius:999px; background:#2a3042; border:1px solid var(--border); position:relative}
    .dot.is-full{background:var(--red)}
    .dot.is-cardio{background:#ff9f5c}
    .dot.is-rest{background:#7fa0c0}
    .dayDot.active{outline:2px solid var(--blue)}
    .check{font-size:11px; opacity:.9}
    .btn{background:#1c2533; color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:7px 10px; cursor:pointer}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:8px}

    /* Controls */
    .controls .pair{display:grid; grid-template-columns:160px 1fr; gap:10px; align-items:center; margin:8px 0}
    input[type="range"]{width:100%}
    .badge{font-size:12px; padding:3px 8px; border-radius:999px; background:var(--chip); color:var(--muted); border:1px solid var(--border)}

    /* Plan blocs (collapsibles) */
    .stack{display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px}
    .dayCard{position:relative; border-left:12px solid transparent}
    .dayCard[data-type="muscu"]{border-left-color:var(--green)}
    .dayCard[data-type="cardio"]{border-left-color:var(--blue)}
    .dayCard[data-type="rest"]{border-left-color:var(--gray)}
    .dayHead{display:flex; align-items:center; gap:10px;}
    .toggle{appearance:none; background:#1c2533; border:1px solid var(--border); color:var(--ink); padding:6px 8px; border-radius:10px; cursor:pointer; display:flex; align-items:center; gap:6px}
    .chev{transition:transform .2s ease}
    .toggle[aria-expanded="false"] .chev{transform:rotate(-90deg)}
    .titleTxt{font-weight:600}
    .dayBody{overflow:hidden; transition:max-height .25s ease, opacity .2s ease}
    .dayCard.is-collapsed .dayBody{max-height:0; opacity:0}
    .dayCard:not(.is-collapsed) .dayBody{max-height:2000px; opacity:1}

    .fields{display:grid; grid-template-columns:repeat(6,minmax(0,1fr)); gap:8px; margin-top:8px}
    .short{grid-template-columns:repeat(4,minmax(0,1fr))}
    label{font-size:11px; color:var(--muted)}
    .cell{display:flex; flex-direction:column; gap:4px}
    input[type="text"], input[type="number"], textarea{background:var(--chip); border:1px solid var(--border); color:var(--ink); padding:7px 8px; border-radius:10px}
    textarea{min-height:64px; resize:vertical}
    .ex{border-top:1px dashed var(--border); padding-top:10px; margin-top:10px}
  </style>
</head>
<body>
  <div id="page">
    <h1>Coach ‚Äî Hebdo + Agenda + Plan</h1>

    <!-- ===== TOP ROW ===== -->
    <div class="row">
      <!-- 1) Rappel Hebdo -->
      <section class="card" id="reminder">
        <h2>üìÖ Rappel Hebdo</h2>
        <table>
          <thead><tr><th>Jour</th><th>Type</th><th>Objectif</th></tr></thead>
          <tbody id="remindBody">
            <tr data-day="1"><td>Lundi</td><td>Full Body A</td><td>Force & structure</td></tr>
            <tr data-day="2"><td>Mardi</td><td>Cardio (marche + run)</td><td>Zone 2‚Äì3, r√©cup active</td></tr>
            <tr data-day="3"><td>Mercredi</td><td>Full Body B</td><td>Volume + densit√©</td></tr>
            <tr data-day="4"><td>Jeudi</td><td>Cardio</td><td>D√©stockage, r√©cup√©ration</td></tr>
            <tr data-day="5"><td>Vendredi</td><td>Full Body C</td><td>Combo + puissance</td></tr>
            <tr data-day="6"><td>Samedi</td><td>Cardio (libre)</td><td>Mobilisation / HIIT</td></tr>
            <tr data-day="0"><td>Dimanche</td><td>OFF</td><td>Repos total üßò‚Äç‚ôÇÔ∏è</td></tr>
          </tbody>
        </table>
      </section>

      <!-- 2) Agenda validation -->
      <section class="card" id="agenda">
        <h2>üóìÔ∏è Agenda entra√Ænement</h2>
        <div class="agenda" id="agendaGrid"></div>
        <div class="toolbar">
          <span class="badge">Clique sur un jour pour valider / invalider</span>
          <button class="btn" id="clearAgenda">Effacer validations</button>
        </div>
      </section>

      <!-- 3) R√©glages progressifs -->
      <section class="card controls" id="controls">
        <h2>‚öôÔ∏è R√©glages difficult√©</h2>
        <div class="pair"><span>Offset RPE (‚àí2 √† +2)</span><input id="rpeOffset" type="range" min="-2" max="2" step="1" value="0"></div>
        <div class="pair"><span>+ Charge (points √ó 0,5 kg)</span><input id="loadPoints" type="range" min="0" max="6" step="1" value="0"></div>
        <div class="toolbar">
          <button class="btn" id="applyToday">Appliquer au jour actuel</button>
          <button class="btn" id="resetAdjust">R√©initialiser le jour</button>
          <span id="preview" class="badge">Aper√ßu : RPE +0 ‚Ä¢ +0.0 kg</span>
        </div>
        <p class="muted">R√®gle simple : +1 RPE ‚ûú +1 rep; chaque +2 RPE ‚ûú +1 s√©rie. Les charges num√©riques sont augment√©es de (points √ó 0,5 kg). Sauvegarde locale auto.</p>
      </section>
    </div>

    <!-- ===== PLAN COMPLET (collapsible) ===== -->
    <div class="stack" id="stack">

      <!-- LUNDI -->
      <section class="card dayCard" data-day="1" data-type="muscu">
        <div class="dayHead">
          <button class="toggle" aria-expanded="true" title="Ouvrir/Fermer"><span class="chev">‚ñæ</span></button>
          <span class="titleTxt">üü¢ Lundi ‚Äì Full Body A : Force & Structure</span>
        </div>
        <div class="dayBody">
          <div class="ex" data-ex="D√©velopp√© couch√© barre"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="10" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="10-20" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" step="0.5" value="7.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Pecs/Triceps" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Goblet Squat"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="15" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="5" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="3-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Jambes/Fessiers/Abdos" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Rowing barre pench√©"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="15-20" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-2" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Dos/Biceps" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Soulev√© de terre jambes tendues"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="15-20" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="3-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Ischios/Fessiers/Lombaires" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Pompes sur genoux"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="15" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6.5" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Triceps/Core" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Crunch au sol"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="20" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Abdos sans pression" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Planche"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Dur√©e</label><input type="text" value="40s" data-k="time"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Core stable" data-k="notes"></div>
          </div></div>
          <div class="ex"><div class="fields short">
            <div class="cell"><label>Finisher</label><input type="text" value="V√©lo 5‚Äì8 min Z2" data-k="finisher"></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
          </div></div>
        </div>
      </section>

      <!-- MARDI (Cardio) -->
      <section class="card dayCard" data-day="2" data-type="cardio">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">üîµ Mardi ‚Äì Cardio : Marche + Run (Z2‚Äì3)</span></div>
        <div class="dayBody">
          <div class="ex"><div class="fields short">
            <div class="cell"><label>√âchauffement</label><input type="text" value="5 min Z2" data-k="wu"></div>
            <div class="cell"><label>Bloc</label><input type="text" value="Marche 4 min + Run 1 min √ó 6" data-k="b1"></div>
            <div class="cell"><label>Retour</label><input type="text" value="5 min Z2" data-k="cd"></div>
            <div class="cell"><label>Total</label><input type="text" value="~35 min" data-k="total"></div>
          </div></div>
        </div>
      </section>

      <!-- MERCREDI -->
      <section class="card dayCard" data-day="3" data-type="muscu">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">üîµ Mercredi ‚Äì Full Body B : Volume & Br√ªlage</span></div>
        <div class="dayBody">
          <div class="ex" data-ex="D√©velopp√© halt√®res au sol"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="3/halt√®re" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-2" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Variante pectoraux" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Squat PDC dynamique"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="20" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Cardio + quad" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Rowing halt√®re 1 bras"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="15" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="3-5" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-2" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Contr√¥le + √©quilibre" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Hip Thrust sur banc"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="15" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="PDC/charge" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Fessiers üî•" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="√âl√©vations lat√©rales"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="20" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="√âpaules lat√©rales" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Crunch jambes lev√©es"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="20" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Abdos + protection" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Gainage genoux relev√©s"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Dur√©e</label><input type="text" value="40s" data-k="time"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Core + transverse" data-k="notes"></div>
          </div></div>
          <div class="ex"><div class="fields short">
            <div class="cell"><label>Finisher</label><input type="text" value="Marche rapide 10 min" data-k="finisher"></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
          </div></div>
        </div>
      </section>

      <!-- JEUDI (Cardio LISS) -->
      <section class="card dayCard" data-day="4" data-type="cardio">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">üîµ Jeudi ‚Äì Cardio LISS (marche/tapis)</span></div>
        <div class="dayBody">
          <div class="ex"><div class="fields">
            <div class="cell"><label>Type</label><input type="text" value="Marche rapide" data-k="type"></div>
            <div class="cell"><label>Vitesse</label><input type="text" value="5.5 km/h" data-k="speed"></div>
            <div class="cell"><label>Inclinaison</label><input type="text" value="5%" data-k="incline"></div>
            <div class="cell"><label>Dur√©e</label><input type="text" value="40 min" data-k="time"></div>
            <div class="cell"><label>FC</label><input type="text" value="Z2" data-k="zone"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Podcast/√† jeun (opt)" data-k="notes"></div>
          </div></div>
        </div>
      </section>

      <!-- VENDREDI -->
      <section class="card dayCard" data-day="5" data-type="muscu">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">üî¥ Vendredi ‚Äì Full Body C : Puissance & Combo</span></div>
        <div class="dayBody">
          <div class="ex" data-ex="D√©velopp√© militaire assis"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="10" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="3-5" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="√âpaules/Triceps" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Front Squat"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="4" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="10-20" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="3-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7.5" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Cuisses + gainage" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Tirage menton"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="10-15" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-2" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Trap√®zes/Biceps" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Fentes arri√®re"><div class="fields">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="10" data-k="reps"></div>
            <div class="cell"><label>Charge</label><input type="text" value="PDC/halt√®res" data-k="load"></div>
            <div class="cell"><label>Tempo</label><input type="text" value="2-1-1" data-k="tempo"></div>
            <div class="cell"><label>RPE</label><input type="number" value="7" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Fessiers + cuisses" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Pompes inclin√©es"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="12" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6.5" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Triceps + pecs" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Crunch rotation"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Reps</label><input type="number" value="20" data-k="reps"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Obliques + centre" data-k="notes"></div>
          </div></div>
          <div class="ex" data-ex="Planche + bras"><div class="fields short">
            <div class="cell"><label>S√©ries</label><input type="number" value="3" data-k="sets"></div>
            <div class="cell"><label>Dur√©e</label><input type="text" value="30s" data-k="time"></div>
            <div class="cell"><label>RPE</label><input type="number" value="6" step="0.5" data-k="rpe"></div>
            <div class="cell"><label>Notes</label><input type="text" value="Anti-rotation" data-k="notes"></div>
          </div></div>
          <div class="ex"><div class="fields short">
            <div class="cell"><label>Finisher</label><input type="text" value="V√©lo 8 min (30/30)" data-k="finisher"></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
          </div></div>
        </div>
      </section>

      <!-- SAMEDI Cardio libre -->
      <section class="card dayCard" data-day="6" data-type="cardio">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">üî¥ Samedi ‚Äì Cardio libre / HIIT</span></div>
        <div class="dayBody">
          <div class="ex"><div class="fields">
            <div class="cell"><label>Option</label><input type="text" value="Cycling/Tapis fractionn√©" data-k="opt"></div>
            <div class="cell"><label>Warm-up</label><input type="text" value="5 min" data-k="wu"></div>
            <div class="cell"><label>Bloc A</label><input type="text" value="3√ó (5 min mod√©r√© + 1 min rapide)" data-k="a"></div>
            <div class="cell"><label>Bloc B</label><input type="text" value="2√ó (2 min mod√©r√© + 2 min intense)" data-k="b"></div>
            <div class="cell"><label>Cooldown</label><input type="text" value="5 min" data-k="cd"></div>
            <div class="cell"><label>Total</label><input type="text" value="~30 min" data-k="total"></div>
          </div></div>
        </div>
      </section>

      <!-- DIMANCHE Repos -->
      <section class="card dayCard" data-day="0" data-type="rest">
        <div class="dayHead"><button class="toggle" aria-expanded="true"><span class="chev">‚ñæ</span></button><span class="titleTxt">‚òï Dimanche ‚Äì OFF / R√©cup√©ration</span></div>
        <div class="dayBody">
          <div class="ex"><div class="fields short">
            <div class="cell"><label>Focus</label><input type="text" value="Sommeil, mobilit√© douce, hydratation" data-k="focus"></div>
            <div class="cell"><label>Respiration</label><input type="text" value="Capsule nasale 5 min" data-k="breath"></div>
            <div class="cell"><label>Notes</label><input type="text" placeholder="ressenti" data-k="notes"></div>
            <div class="cell"><label>&nbsp;</label><span></span></div>
          </div></div>
        </div>
      </section>

    </div>

  </div>

  <script>
  (function(){
    const KEY = 'coach_adv_v1';
    const AGENDA_KEY = KEY + '_agenda';
    const BASE_KEY = KEY + '_base';

    const todayJS = new Date();
    let currentDay = todayJS.getDay(); // 0=Dim..6=Sam

    // === Reminder highlight
    document.querySelectorAll('#remindBody tr').forEach(tr=>{
      if(Number(tr.dataset.day) === currentDay){ tr.classList.add('active'); }
    });

    // === Agenda grid
    const grid = document.getElementById('agendaGrid');
    const labels = ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'];
    const types = {0:'rest',1:'full',2:'cardio',3:'full',4:'cardio',5:'full',6:'cardio'};
    const saved = JSON.parse(localStorage.getItem(AGENDA_KEY)||'{}');
    for(let d=1; d<=6; d++) buildDot(d); // Mon..Sat
    buildDot(0); // Sunday at end

    function buildDot(d){
      const wrap = document.createElement('div'); wrap.className='dayDot';
      if(d===currentDay) wrap.classList.add('active');
      const dot = document.createElement('div'); dot.className='dot';
      const t = types[d];
      if(t==='full') dot.classList.add('is-full');
      if(t==='cardio') dot.classList.add('is-cardio');
      if(t==='rest') dot.classList.add('is-rest');
      if(saved[d]) dot.classList.add('done');
      const lbl = document.createElement('div'); lbl.className='dLabel'; lbl.textContent = labels[d];
      const chk = document.createElement('button'); chk.className='btn check'; chk.textContent = saved[d]?'Valid√©':'Valider';
      chk.addEventListener('click', ()=>{
        saved[d] = !saved[d];
        localStorage.setItem(AGENDA_KEY, JSON.stringify(saved));
        chk.textContent = saved[d]? 'Valid√©':'Valider';
        wrap.classList.toggle('active', d===currentDay);
      });
      wrap.append(dot,lbl,chk); grid.appendChild(wrap);
    }

    document.getElementById('clearAgenda').addEventListener('click', ()=>{
      localStorage.removeItem(AGENDA_KEY); location.reload();
    });

    // === Collapsibles
    document.querySelectorAll('.dayCard').forEach(card=>{
      const btn = card.querySelector('.toggle');
      btn.addEventListener('click', ()=>{
        const col = card.classList.toggle('is-collapsed');
        btn.setAttribute('aria-expanded', String(!col));
      });
    });

    // Open current day, collapse others
    document.querySelectorAll('.dayCard').forEach(card=>{
      const d = Number(card.getAttribute('data-day'));
      const btn = card.querySelector('.toggle');
      const isToday = d===currentDay;
      card.classList.toggle('is-collapsed', !isToday);
      btn.setAttribute('aria-expanded', String(isToday));
    });

    // === Persist base values (first time) for progressive adjustments
    if(!localStorage.getItem(BASE_KEY)){
      const snapshot = {};
      document.querySelectorAll('.dayCard').forEach(card=>{
        const d = card.getAttribute('data-day');
        const exos = {};
        card.querySelectorAll('.ex').forEach(ex=>{
          const name = ex.dataset.ex || 'exo';
          const fields = {};
          ex.querySelectorAll('input').forEach(inp=>{ const k = inp.dataset.k; if(k) fields[k]=inp.value; });
          exos[name]=fields;
        });
        snapshot[d]=exos;
      });
      localStorage.setItem(BASE_KEY, JSON.stringify(snapshot));
    }

    // === Controls logic
    const rpeSlider = document.getElementById('rpeOffset');
    const loadSlider = document.getElementById('loadPoints');
    const preview = document.getElementById('preview');
    function syncPreview(){ preview.textContent = `Aper√ßu : RPE ${Number(rpeSlider.value)>=0?'+':''}${rpeSlider.value} ‚Ä¢ +${(Number(loadSlider.value)*0.5).toFixed(1)} kg`; }
    rpeSlider.addEventListener('input', syncPreview);
    loadSlider.addEventListener('input', syncPreview); syncPreview();

    function applyAdjust(day){
      const base = JSON.parse(localStorage.getItem(BASE_KEY)||'{}')[day];
      if(!base) return;
      const rpeOff = Number(rpeSlider.value);
      const extraKg = Number(loadSlider.value)*0.5;
      const card = document.querySelector(`.dayCard[data-day="${day}"]`);
      if(!card) return;
      card.querySelectorAll('.ex').forEach(ex=>{
        const name = ex.dataset.ex || 'exo';
        const fields = base[name] || {};
        // Start from base
        const sets = Number(fields['sets']||ex.querySelector('[data-k="sets"]').value||0);
        const reps = Number(fields['reps']||ex.querySelector('[data-k="reps"]').value||0);
        const rpe  = Number(fields['rpe'] || ex.querySelector('[data-k="rpe"]').value||0);
        const load = (fields['load']||'').toString();

        // Rule: +1 RPE => +1 rep; every +2 RPE => +1 set; negative reduces (kept >= base min 1)
        let newReps = reps + rpeOff;
        let newSets = sets + Math.floor((rpeOff)/2);
        if(newReps < 1) newReps = 1; if(newSets < 1) newSets = 1;

        // Load: increment numeric parts by +extraKg
        let newLoad = load.replace(/(\d+(?:\.\d+)?)/g, (m)=> (parseFloat(m)+extraKg).toString());

        // Push back to UI
        const rI = ex.querySelector('[data-k="reps"]'); if(rI) rI.value = String(newReps);
        const sI = ex.querySelector('[data-k="sets"]'); if(sI) sI.value = String(newSets);
        const lI = ex.querySelector('[data-k="load"]'); if(lI && load) lI.value = newLoad;
        const rpI = ex.querySelector('[data-k="rpe"]'); if(rpI) rpI.value = (rpe + rpeOff).toFixed(1).replace(/\.0$/, '');
      });
    }

    function resetDay(day){
      const base = JSON.parse(localStorage.getItem(BASE_KEY)||'{}')[day];
      if(!base) return;
      const card = document.querySelector(`.dayCard[data-day="${day}"]`);
      if(!card) return;
      card.querySelectorAll('.ex').forEach(ex=>{
        const name = ex.dataset.ex || 'exo';
        const f = base[name]||{};
        for(const [k,v] of Object.entries(f)){
          const inp = ex.querySelector(`[data-k="${k}"]`); if(inp) inp.value = v;
        }
      });
    }

    document.getElementById('applyToday').addEventListener('click', ()=> applyAdjust(currentDay));
    document.getElementById('resetAdjust').addEventListener('click', ()=> resetDay(currentDay));

    // Auto-update at midnight (changes highlight/open day)
    let dayStamp = new Date().toDateString();
    setInterval(()=>{
      const now = new Date();
      if(now.toDateString()!==dayStamp){ location.reload(); }
    }, 60000);
  })();
  </script>
</body>
</html>
