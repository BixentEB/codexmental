<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Routine capillaire + Phases KÃ©ratine</title>
<style>
:root{
  --bg:#0b0f14; --panel:#121821; --text:#e6edf3; --muted:#8aa0b3;
  --line:#223041; --tag:#1b2431; --accent:#89d185; --warn:#ffd166;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0a111a,#0b0f14 40%);color:var(--text);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,sans-serif}
.wrap{max-width:1100px;margin:auto;padding:24px}
h1{margin:0 0 10px;font-size:clamp(20px,3.6vw,28px)}
small.muted{color:var(--muted)}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}
.tag{display:inline-block;background:var(--tag);border:1px solid var(--line);padding:2px 8px;border-radius:999px;color:#cfe7ff;font-size:.8rem}

/* Today card */
.today{display:grid;gap:10px;margin:14px 0}
.today h3{margin:0 0 6px}
.today .cols{display:grid;gap:12px;grid-template-columns:1.2fr 1.2fr .9fr}
.today ul{margin:8px 0 0 18px}
.today .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{border:1px solid var(--line);background:#0f1722;padding:4px 10px;border-radius:999px}

/* Tabs */
.tabs{margin-top:14px}
.tab-head{display:flex;gap:8px;flex-wrap:wrap}
.tab-head button{
  background:var(--tag);border:1px solid var(--line);color:var(--text);padding:8px 12px;border-radius:999px;cursor:pointer
}
.tab-head button[aria-selected="true"]{background:#1c2736}
.tab{display:none;margin-top:12px}
.tab.active{display:block}

/* Week grid (Semaine type) */
.grid{display:grid;gap:12px;grid-template-columns:140px 1fr 1fr 1.1fr}
.head,.cell{background:var(--panel);border:1px solid var(--line)}
.head{padding:10px 12px;font-weight:700;text-transform:uppercase;background:linear-gradient(180deg,#131b25,#101722)}
.row{display:contents}.cell{padding:12px}.note{color:var(--muted)}
.day{font-weight:700}.subtag{margin-top:6px}
.todo{display:grid;gap:10px}
.todo label{display:grid;grid-template-columns:auto 1fr;gap:8px;align-items:baseline;background:rgba(255,255,255,.02);padding:8px;border:1px dashed var(--line);border-radius:10px}
@media(max-width:870px){
  .grid{grid-template-columns:1fr}.head{display:none}
  .today .cols{grid-template-columns:1fr}
}

/* Keratin phases */
.k-box{display:grid;gap:12px}
.k-top{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input[type="date"]{background:var(--tag);border:1px solid var(--line);color:var(--text);padding:8px;border-radius:10px}
.k-dosage{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.k-timeline{display:grid;gap:10px;margin-top:8px}
.k-phase{padding:10px;border:1px dashed var(--line);border-radius:10px}
.k-phase b{display:block;margin-bottom:6px}
.k-note{color:var(--muted);font-size:.95rem}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
button{background:var(--tag);border:1px solid var(--line);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
button:hover{filter:brightness(1.07)}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸŒ• Routine capillaire + Phases KÃ©ratine</h1>
  <small class="muted">
    Shampoings <b>lundi & jeudi</b> â€¢ Huile dâ€™oignon <b>la veille (mer & dim) et le jour mÃªme (prÃ©-shampoing)</b> â€¢
    Minoxidil matin/soir sur cuir chevelu <b>sec</b>. Les phases <b>kÃ©ratine</b> sont des <u>dosages par pÃ©riodes</u>.
  </small>

  <!-- TODAY CARD -->
  <div class="panel today" id="todayCard">
    <div class="meta">
      <span class="pill">ğŸ“… <b id="todayDate">â€”</b></span>
      <span class="pill">ğŸ§­ <b id="todayJour">â€”</b></span>
      <span id="todayTag" class="tag">Routine</span>
      <span class="pill">ğŸ’Š <span id="todayKeratin">â€”</span></span>
    </div>
    <div class="cols">
      <div>
        <b>Matin</b>
        <ul id="todayMatin"></ul>
      </div>
      <div>
        <b>Soir</b>
        <ul id="todaySoir"></ul>
      </div>
      <div>
        <b>MÃ©mo</b>
        <div class="muted" id="todayNote">â€”</div>
      </div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab-head">
      <button data-tab="week" aria-selected="true">ğŸ—“ï¸ Semaine type</button>
      <button data-tab="attack">âš¡ KÃ©ratine â€“ Phase dâ€™attaque</button>
      <button data-tab="maint">ğŸŒ¿ KÃ©ratine â€“ Phase dâ€™entretien</button>
    </div>

    <!-- Semaine type -->
    <section id="week" class="tab active">
      <div class="grid" id="weekGrid" aria-live="polite"></div>
    </section>

    <!-- KÃ©ratine â€“ Attaque -->
    <section id="attack" class="tab">
      <div class="k-box">
        <div class="k-top">
          <span class="tag">Protocole dâ€™attaque total : 45 jours</span>
          <div class="k-dosage">
            <label>DÃ©marrer le protocole le :
              <input id="startAttack" type="date">
            </label>
            <span id="attackStatus" class="pill">Jour â€” Dosage â€”</span>
            <div class="actions">
              <button id="todayAttack">Mettre sur aujourdâ€™hui</button>
              <button id="activateAttack">Activer ce protocole</button>
              <button id="resetAttack">RÃ©initialiser</button>
            </div>
          </div>
        </div>
        <div class="k-timeline">
          <div class="k-phase">
            <b>Phase 1 (J1â€“J15) â€” 2 gÃ©lules / jour</b>
            <div class="k-note">Accent structure (kÃ©ratine, zinc, vitamines B).</div>
          </div>
          <div class="k-phase">
            <b>Phase 2 (J16â€“J45) â€” 3 gÃ©lules / jour</b>
            <div class="k-note">Accent acides aminÃ©s soufrÃ©s (cystine, lysine, mÃ©thionine) + prÃªle.</div>
          </div>
        </div>
        <div class="panel">
          <b>Rappel quotidien (Ã  combiner avec la Semaine type) :</b>
          <ul>
            <li>Matin : ğŸ§… Jus dâ€™oignon (â‰¤1 h) â†’ rinÃ§age â†’ sÃ©chage â†’ ğŸ’§ Minoxidil 5 %.</li>
            <li>Soir : ğŸ§… Jus dâ€™oignon (â‰¤1 h) â†’ rinÃ§age â†’ sÃ©chage â†’ ğŸ’§ Minoxidil 5 %.</li>
            <li>Huile dâ€™oignon : veille et jour de shampoing (lun/jeu), 2 h ou nuit sous charlotte.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- KÃ©ratine â€“ Entretien -->
    <section id="maint" class="tab">
      <div class="k-box">
        <div class="k-top">
          <span class="tag">Protocole dâ€™entretien total : 75 jours</span>
          <div class="k-dosage">
            <label>DÃ©marrer lâ€™entretien le :
              <input id="startMaint" type="date">
            </label>
            <span id="maintStatus" class="pill">Jour â€” Dosage â€”</span>
            <div class="actions">
              <button id="todayMaint">Mettre sur aujourdâ€™hui</button>
              <button id="activateMaint">Activer ce protocole</button>
              <button id="resetMaint">RÃ©initialiser</button>
            </div>
          </div>
        </div>
        <div class="k-timeline">
          <div class="k-phase">
            <b>Phase 1 (J1â€“J30) â€” 1 gÃ©lule / jour</b>
            <div class="k-note">Stabilisation et entretien de la fibre.</div>
          </div>
          <div class="k-phase">
            <b>Phase 2 (J31â€“J75) â€” 2 gÃ©lules / jour</b>
            <div class="k-note">Consolidation et prÃ©vention de la chute.</div>
          </div>
        </div>
        <div class="panel">
          <b>Rappel quotidien (Ã  combiner avec la Semaine type) :</b>
          <ul>
            <li>Conserve le mÃªme rituel oignon/minoxidil et les huiles la veille/jour de shampoing.</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
/* ---------- Onglets ---------- */
document.querySelectorAll('.tab-head button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-head button').forEach(b=>b.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

/* ---------- PARAMÃˆTRES LOGIQUES ---------- */
// Lundi & Jeudi = shampoing
const SHAMPOO_DAYS = [1,4]; // 1=Mon â€¦ 7=Sun
const OIL_DURATION = "2 h ou nuit (sous charlotte)";

/* ---------- KÃ‰RATINE : Ã©tat global + helpers ---------- */
const Keratin = {
  mode: localStorage.getItem("ker-mode") || "attack", // "attack" | "maint"
  startAttack: localStorage.getItem("ker-attack-start") || "",
  startMaint:  localStorage.getItem("ker-maint-start")  || "",
  setMode(m){ this.mode=m; localStorage.setItem("ker-mode",m); refreshToday(); },
  setStart(key,val){ localStorage.setItem(key,val); this[key] = val; refreshToday(); },
  doseFor(dateStr){
    const mode=this.mode;
    const start = mode==="attack" ? this.startAttack : this.startMaint;
    if(!start) return "â€” (dÃ©finir la date de dÃ©but)";
    const d0=new Date(start), d=new Date(dateStr);
    d0.setHours(0,0,0,0); d.setHours(0,0,0,0);
    const j=Math.floor((d-d0)/86400000)+1;

    if(mode==="attack"){
      if(j<1) return "â€” (pas commencÃ©)";
      if(j<=15) return "2 gÃ©l./jour (P1)";
      if(j<=45) return "3 gÃ©l./jour (P2)";
      return "âœ“ Attaque terminÃ©e";
    }else{
      if(j<1) return "â€” (pas commencÃ©)";
      if(j<=30) return "1 gÃ©l./jour (P1)";
      if(j<=75) return "2 gÃ©l./jour (P2)";
      return "âœ“ Entretien terminÃ©";
    }
  }
};

/* ---------- UI de la section KÃ‰RATINE ---------- */
const startAttack = document.getElementById('startAttack');
const attackStatus = document.getElementById('attackStatus');
const startMaint  = document.getElementById('startMaint');
const maintStatus = document.getElementById('maintStatus');

startAttack.value = Keratin.startAttack;
startMaint.value  = Keratin.startMaint;

function fmt(d){return d.toISOString().slice(0,10);}
function daysSince(start){
  const s=new Date(start), t=new Date();
  s.setHours(0,0,0,0); t.setHours(0,0,0,0);
  return Math.floor((t-s)/86400000)+1;
}
function updAttack(){
  const v=startAttack.value;
  attackStatus.textContent = v ? (()=>{
    const j=daysSince(v);
    if(j<1) return "Jour â€” (pas commencÃ©)";
    if(j<=15) return `Jour ${j} Â· 2 gÃ©l./jour (P1)`;
    if(j<=45) return `Jour ${j} Â· 3 gÃ©l./jour (P2)`;
    return `Jour ${j} Â· âœ“ Attaque terminÃ©e`;
  })() : "Jour â€” Dosage â€”";
  Keratin.setStart("ker-attack-start", v);
}
function updMaint(){
  const v=startMaint.value;
  maintStatus.textContent = v ? (()=>{
    const j=daysSince(v);
    if(j<1) return "Jour â€” (pas commencÃ©)";
    if(j<=30) return `Jour ${j} Â· 1 gÃ©l./jour (P1)`;
    if(j<=75) return `Jour ${j} Â· 2 gÃ©l./jour (P2)`;
    return `Jour ${j} Â· âœ“ Entretien terminÃ©`;
  })() : "Jour â€” Dosage â€”";
  Keratin.setStart("ker-maint-start", v);
}
document.getElementById('todayAttack').addEventListener('click',()=>{ startAttack.value=fmt(new Date()); updAttack(); });
document.getElementById('resetAttack').addEventListener('click',()=>{ startAttack.value=""; updAttack(); });
document.getElementById('activateAttack').addEventListener('click',()=> Keratin.setMode("attack"));

document.getElementById('todayMaint').addEventListener('click',()=>{ startMaint.value=fmt(new Date()); updMaint(); });
document.getElementById('resetMaint').addEventListener('click',()=>{ startMaint.value=""; updMaint(); });
document.getElementById('activateMaint').addEventListener('click',()=> Keratin.setMode("maint"));

updAttack(); updMaint();

/* ---------- GÃ©nÃ©ration automatique de la semaine ---------- */
const DAY_NAMES = ["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];

function isVeille(dayNum){
  // veille = la veille dâ€™un jour de shampoing
  return SHAMPOO_DAYS.some(sd => ((sd + 5) % 7) + 1 === dayNum);
}

function buildDay(dayNum){
  const name = DAY_NAMES[dayNum-1];
  const shampooDay = SHAMPOO_DAYS.includes(dayNum);
  const veille = isVeille(dayNum);

  let matin = [
    "ğŸ§… Jus dâ€™oignon (1 h) â†’ RinÃ§age â†’ SÃ©chage",
    "ğŸ’§ Minoxidil 5 %"
  ];
  let soir = [
    "ğŸ§… Jus dâ€™oignon (1 h) â†’ RinÃ§age â†’ SÃ©chage",
    "ğŸ’§ Minoxidil 5 %"
  ];
  let tag = "";
  let note = "Routine classique â€” stimulation + hydratation interne.";

  if(veille){
    tag = "Veille soin huile";
    soir = [`ğŸ’†â€â™‚ï¸ Huile dâ€™oignon ${OIL_DURATION}`]; // pas de minoxidil juste aprÃ¨s lâ€™huile
    note = "Masse doucement le cuir chevelu pendant lâ€™huile.";
  }
  if(shampooDay){
    tag = "Jour de shampoing";
    matin = [
      `ğŸ’†â€â™‚ï¸ Huile dâ€™oignon ${OIL_DURATION} (prÃ©-shampoing)`,
      "ğŸ§´ Shampoing doux â†’ SÃ©chage",
      "ğŸ’§ Minoxidil 5 %"
    ];
    soir = ["ğŸ’§ Minoxidil 5 %"];
    note = "Cuir chevelu propre, prÃªt Ã  absorber les actifs. Laisse bien respirer.";
  }
  if(name==="Dimanche" && !shampooDay && !veille){
    note = "RÃ©cupÃ©ration & visualisation de la repousse ğŸŒ±.";
  }

  return { j:name, tag, m:matin, s:soir, note };
}

const week = Array.from({length:7}, (_,i)=>buildDay(i+1));

/* ---------- Rendu de la grille hebdo (cases Ã  cocher) ---------- */
const table = document.getElementById('weekGrid');
["Jour","Matin","Soir","Notes"].forEach(h=>{
  const d=document.createElement('div');d.className='head';d.textContent=h;table.appendChild(d);
});
const KEY="cap-week-v3";
const saved=JSON.parse(localStorage.getItem(KEY)||"{}");
function chk(id, text){
  const L=document.createElement('label');
  const c=document.createElement('input'); c.type='checkbox'; c.checked=!!saved[id];
  c.addEventListener('change',()=>{saved[id]=c.checked; localStorage.setItem(KEY,JSON.stringify(saved));});
  const s=document.createElement('span'); s.textContent=text;
  L.appendChild(c); L.appendChild(s); return L;
}
week.forEach((d,di)=>{
  const cDay=document.createElement('div'); cDay.className='cell';
  cDay.innerHTML=`<div class="day">${d.j}${d.tag?`<div class="tag subtag">${d.tag}</div>`:''}</div>`;
  const cM=document.createElement('div'); cM.className='cell'; const tm=document.createElement('div'); tm.className='todo';
  d.m.forEach((t,ti)=>tm.appendChild(chk(`m-${di}-${ti}`,t))); cM.appendChild(tm);
  const cS=document.createElement('div'); cS.className='cell'; const ts=document.createElement('div'); ts.className='todo';
  d.s.forEach((t,ti)=>ts.appendChild(chk(`s-${di}-${ti}`,t))); cS.appendChild(ts);
  const cN=document.createElement('div'); cN.className='cell'; cN.innerHTML=`<div class="note">${d.note}</div>`;
  [cDay,cM,cS,cN].forEach(x=>table.appendChild(x));
});

/* ---------- Bloc â€œAujourdâ€™huiâ€ ---------- */
function todayCardData(){
  const now=new Date();
  const dow=((now.getDay()+6)%7)+1; // 1..7
  const dateStr=now.toISOString().slice(0,10);
  const d=buildDay(dow);
  return {
    date: dateStr,
    jour: d.j,
    tag: d.tag || "Routine",
    matin: d.m,
    soir: d.s,
    note: d.note,
    keratin: Keratin.doseFor(dateStr)
  };
}
function refreshToday(){
  const t=todayCardData();
  document.getElementById('todayDate').textContent=t.date;
  document.getElementById('todayJour').textContent=t.jour;
  document.getElementById('todayTag').textContent=t.tag;
  document.getElementById('todayKeratin').textContent=t.keratin;
  document.getElementById('todayMatin').innerHTML=t.matin.map(x=>`<li>${x}</li>`).join('');
  document.getElementById('todaySoir').innerHTML=t.soir.map(x=>`<li>${x}</li>`).join('');
  document.getElementById('todayNote').textContent=t.note;
}
refreshToday();
</script>
</body>
</html>
