<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur de Phases Lunaires</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .simul-widget {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .simul-title {
            color: #333;
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .moon-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .moon-phase {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: #222;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
        
        #simul-svg {
            width: 100%;
            height: 100%;
        }
        
        #simul-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(to right, 
                #000 0%, 
                #000 3%, 
                #333 22%, 
                #666 28%, 
                #999 47%, 
                #ccc 53%, 
                #999 72%, 
                #666 78%, 
                #333 97%, 
                #000 100%);
            border-radius: 5px;
            outline: none;
            margin: 15px 0;
        }
        
        #simul-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #4a6fa5;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        
        .slider-marks {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 5px;
        }
        
        .slider-mark {
            width: 2px;
            height: 10px;
            background-color: #666;
        }
        
        #simul-label {
            font-size: 1.2em;
            color: #4a6fa5;
            font-weight: bold;
            min-height: 1.5em;
            margin: 10px 0;
        }
        
        #simul-reset {
            background-color: #4a6fa5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        
        #simul-reset:hover {
            background-color: #3a5a80;
        }
        
        .moon-date {
            font-size: 1.1em;
            color: #555;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="simul-moon-container"></div>

    <script>
        (() => {
            const wrapper = document.createElement("div");
            wrapper.className = "simul-widget";

            const container = document.createElement("div");
            container.id = "simul-moon";
            container.innerHTML = `
                <h3 class="simul-title">ðŸŒ™ Simulateur Lunaire</h3>
                <div class="moon-wrapper">
                    <svg id="simul-svg" viewBox="0 0 100 100" class="moon-phase">
                        <defs>
                            <clipPath id="simul-clip">
                                <circle cx="50" cy="50" r="50" />
                            </clipPath>
                            <mask id="simul-mask">
                                <rect width="100" height="100" fill="white" />
                                <path id="simul-shadow-path" fill="black" />
                            </mask>
                        </defs>
                        <circle cx="50" cy="50" r="50" fill="#fff" mask="url(#simul-mask)" clip-path="url(#simul-clip)" />
                    </svg>
                    <div class="moon-date" id="simul-date"></div>
                    <input type="range" id="simul-slider" min="0" max="29.53" step="0.1" value="0">
                    <div class="slider-marks">
                        ${Array(8).fill().map((_,i) => `<div class="slider-mark"></div>`).join('')}
                    </div>
                    <div id="simul-label">Phase : ...</div>
                    <button id="simul-reset">â†º Phase actuelle</button>
                </div>
            `;

            wrapper.appendChild(container);
            document.getElementById("simul-moon-container").appendChild(wrapper);

            const slider = document.getElementById("simul-slider");
            const shadowPath = document.getElementById("simul-shadow-path");
            const label = document.getElementById("simul-label");
            const resetBtn = document.getElementById("simul-reset");
            const dateLabel = document.getElementById("simul-date");

            // Points clÃ©s du cycle lunaire (jours depuis nouvelle lune)
            const PHASE_POINTS = {
                NEW: 0,
                WAXING_CRESCENT: 3.7,
                FIRST_QUARTER: 7.4,
                WAXING_GIBBOUS: 11.1,
                FULL: 14.77,
                WANING_GIBBOUS: 18.44,
                LAST_QUARTER: 22.17,
                WANING_CRESCENT: 25.84
            };

            function getPhaseName(day) {
                day = day % 29.53;
                
                if (day < 1 || day > 28.5) return "ðŸŒ‘ Nouvelle Lune";
                if (day < PHASE_POINTS.WAXING_CRESCENT) return "ðŸŒ’ Croissant naissant";
                if (day < PHASE_POINTS.FIRST_QUARTER) return "ðŸŒ“ Premier Quartier";
                if (day < PHASE_POINTS.WAXING_GIBBOUS) return "ðŸŒ” Gibbeuse croissante";
                if (day < PHASE_POINTS.FULL) return "ðŸŒ• Pleine Lune";
                if (day < PHASE_POINTS.WANING_GIBBOUS) return "ðŸŒ– Gibbeuse dÃ©croissante";
                if (day < PHASE_POINTS.LAST_QUARTER) return "ðŸŒ— Dernier Quartier";
                if (day < PHASE_POINTS.WANING_CRESCENT) return "ðŸŒ˜ Croissant final";
                return "ðŸŒ‘ Nouvelle Lune";
            }

            function updatePhaseVisual(day) {
                day = day % 29.53;
                const phase = day / 29.53; // NormalisÃ© 0-1
                const isWaxing = phase < 0.5;
                const illumination = Math.abs(0.5 - phase) * 2;
                
                const cx = 50, cy = 50, r = 50;
                
                // Nouvelle Lune
                if (illumination > 0.98) {
                    shadowPath.setAttribute("d", "M0,0h100v100h-100z");
                    return;
                }
                
                // Pleine Lune
                if (illumination < 0.02) {
                    shadowPath.setAttribute("d", "M0,0");
                    return;
                }
                
                const ellipseWidth = r * 2 * (1 - illumination);
                const controlOffset = r * 0.55 * (1 - illumination);
                
                let path;
                if (isWaxing) {
                    path = `M ${cx},${cy - r}
                            A ${r},${r} 0 0,1 ${cx},${cy + r}
                            A ${ellipseWidth},${r} 0 0,0 ${cx},${cy - r} Z`;
                } else {
                    path = `M ${cx},${cy - r}
                            A ${ellipseWidth},${r} 0 0,1 ${cx},${cy + r}
                            A ${r},${r} 0 0,0 ${cx},${cy - r} Z`;
                }
                
                shadowPath.setAttribute("d", path);
            }

            function updateSimulatedDate(day) {
                const now = new Date();
                const lunarCycle = 29.53;
                const currentDay = getCurrentMoonDay();
                
                let dayDifference = day - currentDay;
                if (dayDifference < 0) dayDifference += lunarCycle;
                
                const simulatedDate = new Date(now);
                simulatedDate.setDate(now.getDate() + Math.round(dayDifference));
                
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dateLabel.textContent = simulatedDate.toLocaleDateString('fr-FR', options);
            }

            function getCurrentMoonDay() {
                // Date de rÃ©fÃ©rence: nouvelle lune connue
                const knownNewMoon = new Date('2023-11-13T09:27:00Z');
                const now = new Date();
                const diffInDays = (now - knownNewMoon) / (1000 * 60 * 60 * 24);
                return diffInDays % 29.53;
            }

            function updateFromSlider() {
                const day = parseFloat(slider.value);
                updatePhaseVisual(day);
                label.textContent = `Phase : ${getPhaseName(day)}`;
                updateSimulatedDate(day);
            }

            function resetToCurrentPhase() {
                const currentDay = getCurrentMoonDay();
                slider.value = currentDay.toFixed(1);
                updateFromSlider();
            }

            // Initialisation
            resetToCurrentPhase();
            slider.addEventListener("input", updateFromSlider);
            resetBtn.addEventListener("click", resetToCurrentPhase);
        })();
    </script>
</body>
</html>
