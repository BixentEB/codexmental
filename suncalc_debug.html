<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug SunCalc - Analyse Lunaire</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #1a1a2e; 
            color: white; 
        }
        .debug-box { 
            background: #16213e; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #4fc3f7; 
        }
        .phase-visual { 
            width: 100px; 
            height: 100px; 
            border: 2px solid #4fc3f7; 
            border-radius: 50%; 
            margin: 10px 0; 
            display: inline-block; 
        }
    </style>
</head>
<body>
    <h1>üåô Debug SunCalc - Donn√©es Lunaires Actuelles</h1>
    
    <div class="debug-box" id="current-data">
        <h2>Chargement de SunCalc...</h2>
    </div>
    
    <div class="debug-box" id="interpretation">
        <h2>Interpr√©tation des donn√©es</h2>
        <div id="phase-analysis"></div>
    </div>
    
    <div class="debug-box" id="examples">
        <h2>Exemples pour comprendre le cycle</h2>
        <div id="cycle-examples"></div>
    </div>

    <script>
        function loadSunCalc(callback) {
            if (window.SunCalc) {
                callback();
                return;
            }
            
            const script = document.createElement("script");
            script.src = "https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js";
            script.onload = callback;
            script.onerror = () => {
                document.getElementById('current-data').innerHTML = `
                    <h2>‚ùå Erreur de chargement SunCalc</h2>
                    <p>Impossible de charger la biblioth√®que SunCalc depuis le CDN.</p>
                    <p>Essayons une autre m√©thode...</p>
                `;
                
                // Essayer une autre URL
                const script2 = document.createElement("script");
                script2.src = "https://unpkg.com/suncalc@1.9.0/suncalc.js";
                script2.onload = callback;
                script2.onerror = () => {
                    document.getElementById('current-data').innerHTML = `
                        <h2>‚ùå Erreur de chargement SunCalc</h2>
                        <p>Impossible de charger SunCalc depuis les CDN.</p>
                        <p>V√©rifiez votre connexion internet ou les restrictions de s√©curit√©.</p>
                    `;
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script);
        }
        
        function analyzeCurrentMoon() {
            if (!window.SunCalc) {
                document.getElementById('current-data').innerHTML = `
                    <h2>‚è≥ SunCalc non disponible</h2>
                    <p>Tentative de rechargement...</p>
                `;
                loadSunCalc(analyzeCurrentMoon);
                return;
            }
            const now = new Date();
            const moon = SunCalc.getMoonIllumination(now);
            
            document.getElementById('current-data').innerHTML = `
                <h2>üìÖ ${now.toLocaleDateString('fr-FR')} √† ${now.toLocaleTimeString('fr-FR')}</h2>
                <p><strong>Fraction (illumination):</strong> ${(moon.fraction * 100).toFixed(2)}%</p>
                <p><strong>Phase (position cycle):</strong> ${moon.phase.toFixed(4)} (${(moon.phase * 360).toFixed(1)}¬∞)</p>
                <p><strong>Angle:</strong> ${moon.angle.toFixed(4)} radians</p>
            `;
            
            // Analyser la phase
            let phaseType, expectedShadow;
            if (moon.phase < 0.125) {
                phaseType = "üåë Nouvelle lune";
                expectedShadow = "Tout sombre";
            } else if (moon.phase < 0.375) {
                phaseType = "üåí Phase CROISSANTE";
                expectedShadow = "Ombre √† GAUCHE, partie √©clair√©e √† DROITE";
            } else if (moon.phase < 0.625) {
                phaseType = "üåï Autour de la pleine lune";
                expectedShadow = "Tr√®s peu ou pas d'ombre";
            } else if (moon.phase < 0.875) {
                phaseType = "üåñ Phase D√âCROISSANTE";
                expectedShadow = "Ombre √† DROITE, partie √©clair√©e √† GAUCHE";
            } else {
                phaseType = "üåò Fin de cycle (vers nouvelle lune)";
                expectedShadow = "Ombre √† DROITE";
            }
            
            document.getElementById('interpretation').innerHTML = `
                <h2>Interpr√©tation des donn√©es</h2>
                <p><strong>Type de phase:</strong> ${phaseType}</p>
                <p><strong>Ombre attendue:</strong> ${expectedShadow}</p>
                <p><strong>Logique:</strong> phase=${moon.phase.toFixed(3)} ${moon.phase < 0.5 ? '<' : '>'} 0.5 ‚Üí ${moon.phase < 0.5 ? 'CROISSANTE' : 'D√âCROISSANTE'}</p>
            `;
            
            // Exemples du cycle complet
            const examples = [
                { phase: 0, fraction: 0, name: "üåë Nouvelle lune" },
                { phase: 0.125, fraction: 0.25, name: "üåí Croissant croissant" },
                { phase: 0.25, fraction: 0.5, name: "üåì Premier quartier" },
                { phase: 0.375, fraction: 0.75, name: "üåî Gibbeuse croissante" },
                { phase: 0.5, fraction: 1, name: "üåï Pleine lune" },
                { phase: 0.625, fraction: 0.75, name: "üåñ Gibbeuse d√©croissante" },
                { phase: 0.75, fraction: 0.5, name: "üåó Dernier quartier" },
                { phase: 0.875, fraction: 0.25, name: "üåò Croissant d√©croissant" }
            ];
            
            let exampleHTML = "<table border='1' style='border-collapse: collapse; width: 100%;'>";
            exampleHTML += "<tr><th>Phase</th><th>Fraction</th><th>Nom</th><th>Ombre</th></tr>";
            
            examples.forEach(ex => {
                const shadowSide = ex.phase < 0.5 ? "GAUCHE" : "DROITE";
                const currentClass = Math.abs(ex.phase - moon.phase) < 0.1 ? "style='background: #2a4a2a;'" : "";
                exampleHTML += `<tr ${currentClass}>
                    <td>${ex.phase}</td>
                    <td>${(ex.fraction * 100)}%</td>
                    <td>${ex.name}</td>
                    <td>${ex.phase === 0 || ex.phase === 0.5 ? "Sp√©cial" : "Ombre " + shadowSide}</td>
                </tr>`;
            });
            exampleHTML += "</table>";
            
            document.getElementById('cycle-examples').innerHTML = exampleHTML;
        }
        
        // Lancer l'analyse avec gestion d'erreur
        loadSunCalc(() => {
            analyzeCurrentMoon();
            // Mettre √† jour chaque minute
            setInterval(analyzeCurrentMoon, 60000);
        });
    </script>
</body>
</html>